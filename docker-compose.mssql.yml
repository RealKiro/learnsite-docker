version: '3.8'

services:
  # SQL Server 数据库服务（使用自定义镜像，基于 Azure SQL Edge）
  mssql:
    image: orzg/mssql-learnsite:latest
    container_name: mssql

    # 【网络模式选择】
    # 方案 A：使用 host 网络（容器与宿主机共享网络）
    #   - 优点：简单，端口自动映射，容器间可通过 localhost 通信。
    #   - 缺点：端口冲突风险，安全性较低。
    # 方案 B：使用默认 bridge 网络（容器独立，需手动映射端口）
    #   - 优点：隔离性好，端口独立。
    #   - 缺点：容器间无法通过服务名通信，需使用宿主机 IP 或 localhost。
    #
    # 请根据您的需求选择一种模式，取消对应行的注释，并注释掉另一种。
    
    # 方案 A：host 模式（推荐，简单）
    network_mode: host
    # 如果使用 host 模式，不需要 ports 映射，请注释掉下方 ports 部分

    # 方案 B：bridge 模式（如需使用，取消下面注释，并注释上方 network_mode: host）
    # network_mode: bridge
    # ports:
    #   - "1433:1433"

    volumes:
      # 数据库文件持久化：使用相对路径，所有数据保存在当前目录的 data 子目录中
      - ./data:/var/opt/mssql

    environment:
      - ACCEPT_EULA=Y
      # ↓↓↓ 【必须修改】请设置一个强密码（至少8位，含大小写字母、数字和特殊字符）↓↓↓
      - MSSQL_SA_PASSWORD=YourStrong!Password123
      # Azure SQL Edge 不需要指定 PID，已注释掉
      # - MSSQL_PID=Developer

      # SQL 文件下载地址（可选，如不设置则使用镜像内的默认值）
      - PRIMARY_SQL_URL=https://gitee.com/realiy/learnsite/raw/main/sql/learnsite.sql
      - FALLBACK_SQL_URL=https://raw.githubusercontent.com/RealKiro/learnsite/refs/heads/main/sql/learnsite.sql
    restart: unless-stopped