version: '3.8'

services:
  web:
    # 使用您通过 CI 推送的镜像（请替换为实际镜像名）
    image: orzg/learnsite-web:latest
    container_name: learnsite-ci
    ports:
      - "8080:8080"
    volumes:
      # CI 中使用命名卷，避免宿主机路径依赖
      - learnsite_data:/app
      # 如需在本地测试时绑定挂载，可注释上面行，改用以下方式（需根据操作系统修改路径）：
      # ---------- Linux 环境绑定挂载 ----------
      # - /docker_data/learnsite/app:/app
      # ---------- 群晖 NAS 环境绑定挂载 ----------
      # - /volume1/docker/learnsite/app:/app
    environment:
      - MONO_IOMAP=all
      - DB_HOST=mssql
      - DB_NAME=learnsite
      - DB_USER=sa
      # ↓↓↓ 必须修改为你的强密码，与 MSSQL_SA_PASSWORD 保持一致 ↓↓↓
      - DB_PASSWORD=LearnSite2025StrongPwd   # 【必须修改】
      - AUTO_UPDATE_SOURCE=false

      # 通过环境变量切换主备仓库（此处默认 GitHub 主，Gitee 备）
      # 如需互换，取消下面两行的注释并调整顺序（或直接修改值）
      - PRIMARY_REPO_URL=https://github.com/RealKiro/learnsite.git
      - FALLBACK_REPO_URL=https://gitee.com/realiy/learnsite.git

      # SQL 文件下载地址（也可通过环境变量覆盖）
      # - PRIMARY_SQL_URL=https://raw.githubusercontent.com/RealKiro/learnsite/refs/heads/main/sql/learnsite.sql
      # - FALLBACK_SQL_URL=https://gitee.com/realiy/learnsite/raw/main/sql/learnsite.sql
    networks:
      - learnsite-net
    # CI 环境中通常不需要重启策略，可设为 "no"
    restart: "no"

volumes:
  learnsite_data:

networks:
  learnsite-net:
    driver: bridge